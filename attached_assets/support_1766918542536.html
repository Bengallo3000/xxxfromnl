<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Support - fromNL.Top</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a472a;
            --secondary-color: #d4af37;
            --accent-color: #ffffff;
            --text-color: #2d3748;
            --bg-color: #f8f9fa;
        }
        
        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        
        .mono { font-family: 'JetBrains Mono', monospace; }
        .gradient-text { 
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }
        
        .chat-container {
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .message {
            margin-bottom: 1rem;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .message.user {
            text-align: right;
        }
        
        .message.support {
            text-align: left;
        }
        
        .message-bubble {
            display: inline-block;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .message.user .message-bubble {
            background-color: var(--primary-color);
            color: white;
        }
        
        .message.support .message-bubble {
            background-color: #e5e7eb;
            color: var(--text-color);
        }
        
        .typing-indicator {
            display: none;
            padding: 0.75rem 1rem;
            background-color: #e5e7eb;
            border-radius: 1rem;
            margin-bottom: 1rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .online-indicator {
            width: 12px;
            height: 12px;
            background-color: #10b981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold gradient-text">fromNL.Top Admin</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <a href="admin.html" class="text-gray-700 hover:text-green-600 transition-colors">Dashboard</a>
                    <a href="products.html" class="text-gray-700 hover:text-green-600 transition-colors">Products</a>
                    <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <div class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900">Live Support</h2>
                    <p class="text-gray-600 mt-1">Real-time customer support chat</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <span class="online-indicator"></span>
                        <span class="text-sm text-green-600 font-medium">Support Online</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Support Chat Interface -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid lg:grid-cols-4 gap-8">
            <!-- Active Chats Sidebar -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="text-lg font-semibold mb-4">Active Chats</h3>
                    <div id="active-chats" class="space-y-2">
                        <!-- Active chats will be loaded here -->
                    </div>
                    
                    <div class="mt-6 pt-4 border-t">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Support Agents</h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                                <span class="text-sm">Admin</span>
                                <span class="online-indicator"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="lg:col-span-3">
                <div class="bg-white rounded-lg shadow">
                    <!-- Chat Header -->
                    <div class="p-4 border-b flex items-center justify-between">
                        <div>
                            <h3 id="current-chat-user" class="text-lg font-semibold">Select a chat to start</h3>
                            <p id="current-chat-status" class="text-sm text-gray-500">Choose from active chats</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="toggleSound()" class="p-2 text-gray-500 hover:text-green-600 transition-colors" title="Toggle Sound">
                                <svg id="sound-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M6.343 6.343L4.93 4.93A1 1 0 003.515 6.343l1.414 1.414a1 1 0 001.414-1.414zM12 2v4m0 12v4M2 12h4m12 0h4"></path>
                                </svg>
                            </button>
                            <button onclick="endChat()" class="p-2 text-gray-500 hover:text-red-600 transition-colors" title="End Chat">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div class="chat-container">
                        <div id="chat-messages" class="chat-messages">
                            <div class="text-center text-gray-500 p-8">
                                <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <p>Select a chat to start conversation</p>
                            </div>
                        </div>

                        <!-- Typing Indicator -->
                        <div id="typing-indicator" class="typing-indicator">
                            <div class="flex items-center">
                                <div class="typing-dots">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                                <span class="text-sm text-gray-500 ml-2">Support is typing...</span>
                            </div>
                        </div>

                        <!-- Message Input -->
                        <div class="p-4 border-t">
                            <div class="flex items-end space-x-3">
                                <textarea id="message-input" 
                                          placeholder="Type your message..." 
                                          class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"
                                          rows="2"></textarea>
                                <button onclick="sendMessage()" 
                                        class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    Send
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Support chat system
        let currentChatId = null;
        let chats = {};
        let soundEnabled = true;

        // Sample active chats
        const sampleChats = {
            'user_123': {
                id: 'user_123',
                name: 'Customer Support',
                email: 'support@fromnl.top',
                status: 'online',
                messages: [
                    {
                        id: 1,
                        sender: 'support',
                        content: 'Welcome to fromNL.Top support! How can I help you today?',
                        timestamp: new Date().toISOString()
                    }
                ],
                unread: 0,
                lastMessage: new Date().toISOString()
            },
            'user_456': {
                id: 'user_456',
                name: 'John Doe',
                email: 'john@example.com',
                status: 'online',
                messages: [
                    {
                        id: 1,
                        sender: 'user',
                        content: 'Hi, I have a question about shipping',
                        timestamp: new Date(Date.now() - 300000).toISOString()
                    },
                    {
                        id: 2,
                        sender: 'support',
                        content: 'Hello! I\'d be happy to help with shipping questions. Where are you located?',
                        timestamp: new Date(Date.now() - 240000).toISOString()
                    }
                ],
                unread: 1,
                lastMessage: new Date(Date.now() - 240000).toISOString()
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            chats = sampleChats;
            loadActiveChats();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        function loadActiveChats() {
            const container = document.getElementById('active-chats');
            
            if (Object.keys(chats).length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <p>No active chats</p>
                    </div>
                `;
                return;
            }
            
            // Sort chats by last message time
            const sortedChats = Object.values(chats).sort((a, b) => 
                new Date(b.lastMessage) - new Date(a.lastMessage)
            );
            
            container.innerHTML = sortedChats.map(chat => `
                <div class="p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors ${chat.unread > 0 ? 'border-l-4 border-green-500' : ''}"
                     onclick="selectChat('${chat.id}')">
                    <div class="flex items-center justify-between">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">${chat.name}</p>
                            <p class="text-xs text-gray-500 truncate">${chat.email}</p>
                            <p class="text-xs text-gray-400 mt-1">
                                ${formatTime(chat.lastMessage)}
                            </p>
                        </div>
                        ${chat.unread > 0 ? `
                            <span class="bg-green-500 text-white text-xs rounded-full px-2 py-1">
                                ${chat.unread}
                            </span>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function selectChat(chatId) {
            currentChatId = chatId;
            const chat = chats[chatId];
            
            if (!chat) return;
            
            // Update header
            document.getElementById('current-chat-user').textContent = chat.name;
            document.getElementById('current-chat-status').textContent = chat.status === 'online' ? 'Online' : 'Offline';
            
            // Load messages
            loadMessages(chat);
            
            // Mark as read
            if (chat.unread > 0) {
                chat.unread = 0;
                loadActiveChats();
            }
            
            // Focus input
            document.getElementById('message-input').focus();
        }

        function loadMessages(chat) {
            const container = document.getElementById('chat-messages');
            
            if (chat.messages.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 p-8">
                        <p>No messages yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = chat.messages.map(message => `
                <div class="message ${message.sender}">
                    <div class="message-bubble">
                        ${message.content}
                        <div class="text-xs opacity-75 mt-1">
                            ${formatTime(message.timestamp)}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const content = input.value.trim();
            
            if (!content || !currentChatId) return;
            
            const chat = chats[currentChatId];
            const newMessage = {
                id: Date.now(),
                sender: 'support',
                content: content,
                timestamp: new Date().toISOString()
            };
            
            // Add message to chat
            chat.messages.push(newMessage);
            chat.lastMessage = newMessage.timestamp;
            
            // Clear input
            input.value = '';
            
            // Reload messages
            loadMessages(chat);
            loadActiveChats();
            
            // Simulate typing indicator and response
            simulateTyping();
        }

        function simulateTyping() {
            const indicator = document.getElementById('typing-indicator');
            indicator.style.display = 'block';
            
            setTimeout(() => {
                indicator.style.display = 'none';
                
                // Add auto-response
                const responses = [
                    'Thanks for your message. I\'ll help you with that right away.',
                    'I understand your question. Let me check on that for you.',
                    'I\'m here to help. Could you provide more details?',
                    'Thank you for contacting us. I\'ll assist you shortly.',
                    'I see what you mean. Let me get that information for you.'
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addAutoResponse(randomResponse);
            }, 2000);
        }

        function addAutoResponse(content) {
            if (!currentChatId) return;
            
            const chat = chats[currentChatId];
            const newMessage = {
                id: Date.now() + 1,
                sender: 'user',
                content: content,
                timestamp: new Date().toISOString()
            };
            
            chat.messages.push(newMessage);
            chat.lastMessage = newMessage.timestamp;
            chat.unread += 1;
            
            loadMessages(chat);
            loadActiveChats();
            
            // Play sound if enabled
            if (soundEnabled) {
                playNotificationSound();
            }
        }

        function playNotificationSound() {
            // Create a simple beep sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const icon = document.getElementById('sound-icon');
            
            if (soundEnabled) {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M6.343 6.343L4.93 4.93A1 1 0 003.515 6.343l1.414 1.414a1 1 0 001.414-1.414zM12 2v4m0 12v4M2 12h4m12 0h4"></path>';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path>';
            }
        }

        function endChat() {
            if (!currentChatId) return;
            
            if (confirm('Are you sure you want to end this chat?')) {
                delete chats[currentChatId];
                currentChatId = null;
                
                document.getElementById('current-chat-user').textContent = 'Select a chat to start';
                document.getElementById('current-chat-status').textContent = 'Choose from active chats';
                document.getElementById('chat-messages').innerHTML = `
                    <div class="text-center text-gray-500 p-8">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                        <p>Select a chat to start conversation</p>
                    </div>
                `;
                
                loadActiveChats();
            }
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            return date.toLocaleDateString();
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'index.html';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${getNotificationClass(type)}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            anime({
                targets: notification,
                opacity: [0, 1],
                translateX: [100, 0],
                duration: 300,
                easing: 'easeOutQuad'
            });
            
            // Remove after 3 seconds
            setTimeout(() => {
                anime({
                    targets: notification,
                    opacity: [1, 0],
                    translateX: [0, 100],
                    duration: 300,
                    easing: 'easeInQuad',
                    complete: () => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }
                });
            }, 3000);
        }

        function getNotificationClass(type) {
            switch (type) {
                case 'success':
                    return 'bg-green-500 text-white';
                case 'warning':
                    return 'bg-yellow-500 text-white';
                case 'error':
                    return 'bg-red-500 text-white';
                default:
                    return 'bg-blue-500 text-white';
            }
        }

        // Auto-refresh active chats every 30 seconds
        setInterval(() => {
            loadActiveChats();
        }, 30000);
    </script>
</body>
</html>